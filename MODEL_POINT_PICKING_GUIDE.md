# 导入STL模型后的路径点选取指南

## 📋 概述

当你导入STL模型（3D模型）后，系统会自动切换到**模型表面两次点击选点模式**。这个模式不需要体数据，直接在3D视图中点击模型表面即可。

---

## 🎯 选点步骤

### 第一步：导入STL模型

1. 点击 **"Open Local Model"** 按钮
2. 选择STL文件（`.stl`格式）
3. 模型会加载到3D视图中

### 第二步：开始选点

1. 点击路径规划按钮：
   - **"Pick Start Point"** - 选择起点
   - **"Add Waypoint"** - 添加中间点
   - **"Pick End Point"** - 选择终点

2. 系统会自动检测到只有模型没有体数据，启用**两次点击模式**

3. 状态栏会显示提示：
   ```
   Pick Mode: Start Point - Click on model surface in 3D view (need 2 clicks from different views)
   ```

### 第三步：第一次点击

1. **在3D视图中点击模型表面**
   - 必须点击在模型上（不能点击空白处）
   - 系统会显示**深度参考线**（黄色虚线）

2. 状态栏会更新：
   ```
   Step 1: Clicked on Axial view. Step 2: Switch to a different view and click again.
   ```

### 第四步：切换视角

1. **切换到不同的视角**（必须与第一次不同）：
   - 如果第一次是**轴向（Axial）**，切换到**冠状（Coronal）**或**矢状（Sagittal）**
   - 如果第一次是**冠状（Coronal）**，切换到**轴向（Axial）**或**矢状（Sagittal）**
   - 如果第一次是**矢状（Sagittal）**，切换到**轴向（Axial）**或**冠状（Coronal）**

2. **如何切换视角**：
   - 在3D视图中**旋转模型**，直到看到不同的视角
   - 或者使用VTK的相机控制（如果已实现）

### 第五步：第二次点击

1. **在新的视角下，再次点击模型表面**
   - 同样必须点击在模型上

2. 系统会自动：
   - 计算3D坐标
   - 清除深度参考线
   - 添加路径点标记（红色球体）
   - 更新路径列表

3. 状态栏会显示：
   ```
   Start point selected: (x, y, z)
   ```

---

## ⚠️ 注意事项

### 1. 必须点击在模型表面

**为什么必须点击模型表面？**

- **技术原因**：
  - 系统使用 VTK 的 `CellPicker` 来检测点击位置
  - `CellPicker` 只能检测到有几何体的地方（即模型表面）
  - 点击空白处时，`picker.GetCellId()` 返回 -1，表示没有检测到任何几何体
  - 只有点击在模型上，才能获取准确的3D坐标（通过 `picker.GetPickPosition()`）

- **为什么模型是蓝色的？**
  - 这是代码中设置的模型颜色：`RGB(0.3, 0.6, 1.0)` = 浅蓝色
  - 这个颜色只是视觉效果，不影响功能

- ✅ **正确**：点击模型的蓝色表面
- ❌ **错误**：点击空白处（会提示 "Please click on the model surface"）

### 2. 两次点击必须在不同视角

- ✅ **正确**：第一次轴向，第二次冠状
- ❌ **错误**：两次都在同一个视角（会提示 "Please switch to a different view"）

### 3. 视角检测

系统会自动检测当前视角类型：
- **轴向（Axial）**：从上往下看（Z轴方向）
- **冠状（Coronal）**：从前往后看（Y轴方向）
- **矢状（Sagittal）**：从侧面看（X轴方向）

如果无法检测视角，会提示使用标准视角。

### 4. 深度参考线

- 第一次点击后会显示**黄色虚线**（深度参考线）
- 这条线垂直于当前视角，帮助理解深度位置
- 第二次点击后会自动清除

---

## 🔧 如果选点不工作

### 问题1：点击没有反应

**可能原因**：
- VTK交互器未启用
- 事件过滤器未正确安装

**解决方法**：
1. 检查状态栏是否有提示信息
2. 确保已点击路径规划按钮（Start/Waypoint/End）
3. 尝试重新点击路径规划按钮

### 问题2：提示"Please click on the model surface"

**原因**：点击在空白处，没有点击到模型

**解决方法**：
- 确保点击在模型的蓝色表面上
- 可以旋转模型，找到更好的视角

### 问题3：提示"Please switch to a different view"

**原因**：两次点击在同一个视角

**解决方法**：
- 旋转3D视图，切换到不同的视角
- 确保视角有明显变化（例如从轴向切换到冠状）

### 问题4：提示"Cannot detect camera view"

**原因**：系统无法自动检测当前视角类型

**解决方法**：
- 尝试旋转模型到标准视角（轴向/冠状/矢状）
- 确保模型在视图中可见

---

## 📊 选点流程示意图

```
用户操作流程：

1. 导入STL模型
   ↓
2. 点击 "Pick Start Point"
   ↓
3. 在3D视图中点击模型表面（第一次）
   → 显示深度参考线
   → 提示：切换到不同视角
   ↓
4. 旋转3D视图，切换到不同视角
   ↓
5. 再次点击模型表面（第二次）
   → 计算3D坐标
   → 清除深度参考线
   → 添加路径点标记
   → 完成选点
```

---

## 💡 使用技巧

1. **选择合适的视角**：
   - 第一次点击选择模型上容易看到的位置
   - 第二次点击选择正交视角，便于精确定位

2. **利用深度参考线**：
   - 深度参考线帮助理解点击位置的深度
   - 如果深度不对，可以重新开始选点

3. **多次尝试**：
   - 如果选点位置不理想，可以点击 "Reset Path" 重新开始
   - 每次选点都是独立的，可以多次调整

---

## 🎯 完整示例

### 示例：选择起点

1. **导入模型**：点击 "Open Local Model" → 选择 `model.stl`
2. **开始选点**：点击 "Pick Start Point"
3. **第一次点击**：
   - 在3D视图中，旋转到轴向视角（从上往下看）
   - 点击模型表面的目标位置
   - 看到黄色深度参考线
4. **切换视角**：
   - 旋转模型到冠状视角（从前往后看）
5. **第二次点击**：
   - 在新视角下，点击模型表面的目标位置
   - 系统自动计算3D坐标
   - 看到红色球体标记（起点）
6. **完成**：起点已设置，可以继续选择中间点或终点

---

**最后更新**：2026-01-04

